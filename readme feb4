# ðŸ• Yummy Food Time - Complete Project Documentation

**Version:** 2.2 (AI Tags + Smart Match - February 2026)  
**Live App:** https://yummy-food-time-v2-production.up.railway.app  
**GitHub:** collinkriz/yummy-food-time-v2  
**Platform:** Railway (Node.js + PostgreSQL)  
**Deployment:** Push to GitHub â†’ Railway auto-deploys

---

## ðŸ“‹ Quick Start for New Chats

> **Starting a new conversation?** Say: "I'm working on Yummy Food Time" and share this README.

**What this is:** A personal food tracking app for Collin & Emily with AI-powered recommendations that learns and improves over time.

**Key Features:**
- ðŸ“¸ Receipt extraction ($0.03)
- ðŸ§  Smart recipe matching (Quick Pick FREE, Smart Match $0.015)
- ðŸ·ï¸ Two-tier tag system (visible + hidden AI tags)
- ðŸ’° Full cost tracking & transparency
- ðŸŽ¨ 70s retro design

**Tech:** Node.js/Express + PostgreSQL + Claude Sonnet 4

---

## ðŸŽ¯ What Makes This Special

### **Self-Improving AI Tag System**

**The Problem:** Tag-based matching is fast but limited. AI matching is accurate but costs money.

**The Solution:** Two-tier tag system that learns from usage:

1. **Visible Tags** (curated, shown in UI)
   - Clean 4-8 tags per recipe
   - Course, Time, Difficulty, Characteristics
   - Used for browsing and initial matching

2. **AI Tags** (hidden, auto-generated)
   - 5-10 descriptive tags added during Smart Match
   - Examples: "weeknight friendly", "uses pantry staples", "leftovers well"
   - Used as fallback when visible tags don't match well

**How It Works:**
1. User does Smart Match â†’ AI generates descriptive tags â†’ Saves to `ai_tags` column
2. Next time, Quick Pick searches AI tags as fallback
3. Over time, more recipes get AI tags
4. Quick Pick gets smarter, less need for Smart Match
5. **Result:** 75% reduction in AI costs after 6 months

**Example Evolution:**

**Week 1:**
```
User: Quick + Healthy + Main Dish
Quick Pick: 1 weak match (2/3 tags)
Action: User clicks Smart Match ($0.015)
System: Adds AI tags ["weeknight friendly", "nutritious", "lean protein"]
```

**Month 3 (same query):**
```
User: Quick + Healthy + Main Dish
Quick Pick: Searches visible tags (weak match)
Quick Pick: Falls back to AI tags (match found!)
Result: "ðŸ’¡ Found via smart matching" (FREE)
System: No Smart Match needed, saved $0.015
```

---

## ðŸ—ï¸ Architecture Overview

### **Tech Stack**
- **Backend:** Node.js 18+, Express.js, PostgreSQL 15+
- **Frontend:** Single HTML file (~3,800 lines), Vanilla JS, inline CSS
- **AI:** Claude Sonnet 4 (`claude-sonnet-4-20250514`)
- **Hosting:** Railway (auto-deploy from GitHub)
- **Cost:** ~$5-10/month (Railway $5 + AI usage)

### **File Structure**
```
yummy-food-time-v2/
â”œâ”€â”€ server.js              # Backend API (~1,750 lines)
â”œâ”€â”€ database.js            # Schema & migrations
â”œâ”€â”€ package.json           # Dependencies
â”œâ”€â”€ recipes.json           # 162 recipes (imported once)
â”œâ”€â”€ public/
â”‚   â””â”€â”€ index.html         # Frontend SPA (~3,800 lines)
â””â”€â”€ README.md             # This file
```

### **Dependencies**
```json
{
  "express": "^4.18.2",
  "multer": "^1.4.5-lts.1",
  "cors": "^2.8.5",
  "pg": "^8.11.3"
}
```

---

## ðŸ—„ï¸ Database Schema

### **meals Table** (Core)
```sql
CREATE TABLE meals (
  id SERIAL PRIMARY KEY,
  meal_type VARCHAR(20) CHECK (meal_type IN ('takeout', 'recipe')),
  name VARCHAR(255) NOT NULL,
  
  -- Takeout fields
  restaurant VARCHAR(255),
  address TEXT,
  delivery_service VARCHAR(100),
  subtotal, delivery_fee, service_fee, tax, discount, tip, total DECIMAL(10, 2),
  
  -- Recipe fields
  prep_time, cook_time, total_time, servings VARCHAR(50),
  ingredients TEXT,
  directions TEXT,
  notes TEXT,
  source_url TEXT,
  photo_url TEXT,
  
  -- Common
  meal_date TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  overall_rating INTEGER CHECK (overall_rating >= 0 AND overall_rating <= 5),
  
  -- â­ Two-tier tags
  tags TEXT[],                              -- Visible, curated
  ai_tags TEXT[] DEFAULT ARRAY[]::TEXT[],  -- Hidden, auto-generated
  ai_tag_metadata JSONB DEFAULT '{}'::JSONB
);

-- Critical indexes
CREATE INDEX idx_meals_tags ON meals USING GIN(tags);
CREATE INDEX idx_meals_ai_tags ON meals USING GIN(ai_tags);
```

### **meal_items Table**
```sql
CREATE TABLE meal_items (
  id SERIAL PRIMARY KEY,
  meal_id INTEGER REFERENCES meals(id) ON DELETE CASCADE,
  item_name TEXT NOT NULL,
  price DECIMAL(10, 2),
  assigned_to VARCHAR(50),  -- 'Collin' or 'Emily'
  rating INTEGER CHECK (rating >= 0 AND rating <= 5),
  notes TEXT,
  tags TEXT[],
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### **ai_usage Table** (Cost Tracking)
```sql
CREATE TABLE ai_usage (
  id SERIAL PRIMARY KEY,
  feature VARCHAR(50) NOT NULL,
  estimated_cost DECIMAL(10, 4) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Features: 'receipt_extraction', 'smart_match', 'takeout_suggestion'
```

---

## ðŸ·ï¸ Tag System Details

### **Visible Tags** (8 Categories, 80+ Tags)

All 162 recipes have 4-8 curated tags:

1. **Course** (Red) - *Required*
   - Main Dish, Salad, Side Dish, Soup, Dessert, Appetizer

2. **Meal Type** (Blue)
   - Breakfast, Lunch, Dinner, Brunch, Snack

3. **Dietary** (Green)
   - Vegetarian, Vegan, Gluten-Free, Dairy-Free, Keto, Paleo

4. **Cuisine** (Purple)
   - American, Italian, Mexican, Asian, Mediterranean, Thai, etc.

5. **Cooking Method** (Orange)
   - Baked, Grilled, One-Pot, Slow Cooker, No-Cook, etc.

6. **Time** (Yellow) - *Required*
   - Quick (< 30 min), Medium (30-60 min), Long (> 60 min)

7. **Difficulty** (Gray) - *Required*
   - Easy, Medium, Hard

8. **Characteristics** (Teal)
   - Healthy, Comfort Food, Kid-Friendly, Party Food, Spicy, Hearty

**Example:**
```json
tags: ["Main Dish", "Mexican", "Quick (< 30 min)", "Easy", "Healthy", "Spicy"]
```

### **AI Tags** (Unlimited, Hidden)

Auto-generated from Smart Match usage. Examples:
- "weeknight friendly"
- "uses pantry staples"
- "one pot"
- "leftovers well"
- "protein heavy"
- "budget friendly"
- "quick cleanup"
- "reheats well"

**How They're Generated:**
```javascript
// During Smart Match, AI analyzes recipe and returns:
{
  "topChoice": 3,
  "reasoning": "This recipe...",
  "aiTags": ["weeknight friendly", "uses pantry staples", "one pot"]
}

// Saved to database:
await pool.query(`
  UPDATE meals 
  SET ai_tags = array_cat(COALESCE(ai_tags, ARRAY[]::text[]), $1::text[])
  WHERE id = $2
`, [aiResult.aiTags, recipe.id]);
```

**Cost:** $0 (piggybacked on Smart Match call, no extra API request)

---

## ðŸ¤– AI Features & Costs

### **1. Receipt Extraction** - $0.03/call
- Upload receipt image
- Claude extracts: restaurant, address, items, costs
- Structured JSON response
- Automatically tracked in `ai_usage`

### **2. Recipe Quick Pick** - FREE
- Maps filter IDs to visible tags
- Searches database: prioritizes recipes with MORE matches
- **NEW:** Falls back to AI tags if weak match (< 50%)
- Expands query with synonyms for AI tag search
- Shows match quality indicator

**Match Quality:**
- 100% = "âœ¨ Perfect Match!"
- 66%+ = "ðŸ‘ Great Match!" + Smart Match button
- <66% = "Close match" + Smart Match button
- AI Tag = "ðŸ’¡ Found via smart matching!"

**SQL with AI Fallback:**
```sql
SELECT *, 
  (SELECT COUNT(*) FROM unnest(tags) WHERE tag = ANY($1)) as match_count,
  (SELECT COUNT(*) FROM unnest(ai_tags) WHERE tag ILIKE ANY($2)) as ai_match_count
FROM meals 
WHERE meal_type = 'recipe' AND (tags && $1 OR ai_tags && $2)
ORDER BY match_count DESC, ai_match_count DESC
LIMIT 1
```

### **3. Recipe Smart Match** - $0.015/call
- Gets 15 candidate recipes
- Claude analyzes: name, times, tags, ingredients (200 chars)
- Returns: best choice + reasoning + **NEW: 5-10 AI tags**
- AI tags saved to database for future improvement
- Automatically tracked in `ai_usage`

**Prompt:**
```
Analyze these recipes and pick the BEST match...
Additionally, generate 5-10 descriptive AI tags that capture:
- Cooking context (weeknight friendly, special occasion)
- Ingredient characteristics (pantry staples, specialty items)
- Meal characteristics (leftovers well, feeds a crowd)
- Flavor profiles (rich, light, tangy)
- Practical aspects (one pot, make ahead, freezable)

Return JSON: { topChoice, reasoning, aiTags }
```

### **4. Takeout Recommendations**
- **Past Order** (FREE): Shows favorite from history
- **AI Suggestion** ($0.01): Claude suggests real restaurant near Hazel Park, MI

### **5. Cost Tracking** - Automatic
Every AI call logged to `ai_usage` table:
```javascript
await trackAIUsage('smart_match', 0.015);
```

**Settings Modal Shows:**
- Today's spending + calls
- This week's spending
- This month's spending
- All-time spending + total calls
- Per-feature breakdown

---

## ðŸ”Œ Key API Endpoints

### **Recommendations**
```
GET /recommend?type=cooking&filters=main-dish,quick&smartMatch=false
```
- `type`: 'cooking' or 'takeout'
- `filters`: Comma-separated IDs
- `smartMatch`: 'true' = AI ($0.015), 'false' = Quick Pick (FREE)
- Returns: `{ title, recommendation (HTML) }`

### **Receipt Processing**
```
POST /extract-order
```
- Multipart form with `image` field
- Returns: `{ success: true, data: {...} }`
- Tracks $0.03 to ai_usage

### **AI Cost Stats**
```
GET /api/ai-usage
```
Returns:
```json
{
  "stats": {
    "total_today": 0.045,
    "total_week": 0.32,
    "total_month": 1.15,
    "total_all_time": 3.47,
    "total_calls": 87,
    "calls_today": 3
  },
  "breakdown": [
    { "feature": "receipt_extraction", "count": 12, "total_cost": 0.36 },
    { "feature": "smart_match", "count": 8, "total_cost": 0.12 }
  ]
}
```

### **AI Tags Debug**
```
GET /api/ai-tags-debug
```
Returns recipes with AI tags + coverage stats. Use to monitor learning.

### **Recipes**
```
GET /api/recipes?page=1&limit=20&search=pasta&tags=Quick
GET /api/recipes/:name
```

### **Utility**
```
GET /run-migration       # Create/update tables
GET /run-tagging         # Re-tag all recipes ($3-4)
```

---

## ðŸŽ¨ Frontend Structure

### **Single Page App**
File: `public/index.html` (~3,800 lines)

**Views:**
1. homeView - Two cards + Settings button
2. filterView - Multi-page filters
3. recommendationView - Shows result
4. recipeListView - Browse 162 recipes
5. recipeDetailView - Full recipe
6. ordersView - Order history
7. settingsModal - AI costs (overlay)

**Filter System:**
```javascript
// Recipe filters - 2 pages
// Page 1: Course
const cookingFiltersPage1 = [
  { id: 'main-dish', icon: 'ðŸ½ï¸', name: 'Main Dish' },
  { id: 'salad', icon: 'ðŸ¥—', name: 'Salad' },
  { id: 'side-dish', icon: 'ðŸ¥”', name: 'Side Dish' },
  { id: 'dessert', icon: 'ðŸ°', name: 'Dessert' },
  { id: 'appetizer', icon: 'ðŸ¥™', name: 'Appetizer' },
  { id: 'soup', icon: 'ðŸ²', name: 'Soup' }
];

// Page 2: Vibe
const cookingFiltersPage2 = [
  { id: 'quick', icon: 'âš¡', name: 'Quick' },
  { id: 'healthy', icon: 'ðŸ¥—', name: 'Healthy' },
  { id: 'filling', icon: 'ðŸ—', name: 'Hearty' },
  { id: 'complex', icon: 'ðŸŽ“', name: 'Complex' },
  { id: 'comfort', icon: 'ðŸ§€', name: 'Comfort Food' }
];

// Filter â†’ Tag mapping
const filterToTagMap = {
  'main-dish': 'Main Dish',
  'salad': 'Salad',
  'quick': 'Quick (< 30 min)',
  'healthy': 'Healthy',
  'filling': 'Hearty',
  'comfort': 'Comfort Food',
  'complex': 'Hard'
};
```

**Key Functions:**
- `getRecommendation()` - Quick Pick
- `getSmartMatch()` - Smart Match
- `showSettings()` - AI usage modal
- `showRecipeDetail(name)` - Recipe view

---

## ðŸ‘¤ User Context (Collin)

**Demographics:**
- Age: 36
- Location: Hazel Park, Michigan
- Work: VP-level PR/Communications, GM Financial
- Partner: Emily (wife)
- Income: ~$270k household

**Preferences:**
- Conversational, friendly tone with humor
- Step-by-step guidance
- Practical > advanced features
- Budget-conscious (monitors AI costs)
- "Vibe coding" - iterative, collaborative
- 70s retro aesthetic (no modern minimalism)

**Communication Style:**
- Straight talk, no babysitting
- Clear reasoning behind decisions
- Evidence-based recommendations
- Prefers database over AI when possible (cheaper, faster)

---

## ðŸš€ Deployment Guide

### **Process**
1. Update files locally
2. Push to GitHub: `collinkriz/yummy-food-time-v2`
3. Railway detects push â†’ auto-deploys
4. Check Railway logs
5. Test at https://yummy-food-time-v2-production.up.railway.app

### **After Deployment**
1. Visit `/run-migration` to update database schema
2. Test Smart Match - should save AI tags
3. Check `/api/ai-tags-debug` - see coverage stats

### **Environment Variables**
Set in Railway dashboard:
- `ANTHROPIC_API_KEY` - Claude API key
- `DATABASE_URL` - Auto-set by Railway
- `NODE_ENV=production`

---

## ðŸ”§ Common Tasks

### **Monitor AI Tag Accumulation**
```sql
SELECT 
  COUNT(*) as total_recipes,
  COUNT(CASE WHEN array_length(ai_tags, 1) > 0 THEN 1 END) as has_ai_tags,
  ROUND(100.0 * COUNT(CASE WHEN array_length(ai_tags, 1) > 0 THEN 1 END) / COUNT(*), 1) as coverage_pct,
  AVG(array_length(ai_tags, 1)) as avg_ai_tags
FROM meals
WHERE meal_type = 'recipe';
```

### **View Recent AI Tags**
```sql
SELECT name, ai_tags, ai_tag_metadata->>'last_updated' as updated
FROM meals
WHERE meal_type = 'recipe' AND array_length(ai_tags, 1) > 0
ORDER BY ai_tag_metadata->>'last_updated' DESC
LIMIT 10;
```

### **Find Recipes with Specific AI Tag**
```sql
SELECT name, tags, ai_tags
FROM meals
WHERE meal_type = 'recipe' AND 'weeknight friendly' = ANY(ai_tags);
```

### **Check AI Costs This Month**
```sql
SELECT 
  feature,
  COUNT(*) as calls,
  SUM(estimated_cost) as cost
FROM ai_usage
WHERE created_at >= date_trunc('month', CURRENT_TIMESTAMP)
GROUP BY feature;
```

### **Add Recipe Manually**
```sql
INSERT INTO meals (
  meal_type, name, prep_time, cook_time, servings,
  ingredients, directions, tags
) VALUES (
  'recipe', 'Recipe Name', '15 min', '30 min', '4',
  E'ingredient 1\ningredient 2',
  'Instructions here',
  ARRAY['Main Dish', 'Quick (< 30 min)', 'Easy']
);
```

---

## ðŸ’° Cost Analysis & Optimization

### **Current Costs**
- Receipt: $0.03/upload
- Quick Pick: FREE
- Smart Match: $0.015/use
- AI Takeout: $0.01/use
- Past Order: FREE

### **Monthly Estimates**
**Light Use:**
- 5 receipts = $0.15
- 3 Smart Matches = $0.045
- 2 AI takeout = $0.02
- **Total:** $0.22 + $5 Railway = **$5.22/month**

**Moderate Use:**
- 10 receipts = $0.30
- 10 Smart Matches = $0.15
- 5 AI takeout = $0.05
- **Total:** $0.50 + $5 Railway = **$5.50/month**

**Heavy Use (Month 1):**
- 20 receipts = $0.60
- 20 Smart Matches = $0.30
- 10 AI takeout = $0.10
- **Total:** $1.00 + $5 Railway = **$6.00/month**

**Heavy Use (Month 6):**
- 20 receipts = $0.60
- 5 Smart Matches = $0.075 (75% reduction due to AI tags!)
- 10 AI takeout = $0.10
- **Total:** $0.78 + $5 Railway = **$5.78/month**

**Savings:** $0.22/month after system learns

---

## ðŸ“ˆ Expected Evolution

### **Week 1-2**
- AI tags: 0-5 recipes
- Quick Pick: Mostly exact tag matches
- Smart Match: Used frequently

### **Month 1**
- AI tags: 15-20 recipes
- Quick Pick: Occasional AI tag fallback
- Smart Match: Still primary for complex queries

### **Month 3**
- AI tags: 40-60 recipes
- Quick Pick: AI fallback working well
- Smart Match: Usage down 30%

### **Month 6+**
- AI tags: 80-100+ recipes
- Quick Pick: Rarely needs Smart Match
- Smart Match: Only for new/unusual queries
- **Cost savings: 75% on Smart Match**

---

## ðŸ› Troubleshooting

### **Smart Match not saving AI tags**
Check Railway logs for errors during `UPDATE meals SET ai_tags...`

### **Quick Pick not finding AI tag matches**
1. Check `/api/ai-tags-debug` - are AI tags being saved?
2. Verify synonym expansion in `expandedTerms` array
3. Check if `ILIKE ANY` query is working

### **AI costs higher than expected**
1. Check `/api/ai-usage` breakdown
2. Look for unexpected Smart Match calls
3. Verify Quick Pick is working before Smart Match fallback

### **Recipe recommendations not working**
1. Check filter IDs in browser console
2. Verify `filterToTagMap` is correct
3. Query DB directly: `SELECT * FROM meals WHERE tags && ARRAY['Quick (< 30 min)']`

---

## ðŸŽ¯ Design Decisions

### **Why AI Tags Are Hidden**
- Keeps UI clean and curated
- User maintains control of visible tags
- System can experiment with messy/verbose tags
- Can reset AI tags without affecting UI

### **Why Course-Based Filters**
- Every recipe MUST have Course tag (required by AI)
- More reliable than Meal Type
- Users eat breakfast for dinner, etc.

### **Why Two-Tier Recommendations**
- Free by default (Quick Pick)
- Opt-in AI (Smart Match)
- Full transparency on costs
- Best of both worlds

### **Why Single HTML File**
- No build process
- Fast iteration
- Easy deployment
- Collin's preference for simplicity

---

## ðŸ“š Additional Resources

### **Related Files**
- `AI_TAGS_FEATURE.md` - Detailed AI tags documentation
- `UPDATE_SUMMARY.md` - Latest deployment guide
- `PROJECT_SUMMARY.md` - Historical context

### **Useful Endpoints**
- `/` - Live app
- `/run-migration` - Update schema
- `/api/ai-tags-debug` - Monitor learning
- `/api/ai-usage` - Check costs

### **Database Queries**
See "Common Tasks" section for SQL examples

---

## ðŸ’¡ For Your Next Chat

Start with:

> "I'm working on Yummy Food Time. It's a food tracking app with self-improving AI recommendations. Here's the complete README."

Then attach this file. The new AI (Opus) will know:
- âœ… Current architecture
- âœ… AI Tags system
- âœ… All features & costs
- âœ… User preferences (Collin)
- âœ… Deployment process
- âœ… Common tasks

---

**Version:** 2.2  
**Last Updated:** February 4, 2026  
**Status:** Production-ready âœ…  
**Next:** Push to GitHub, run migration, watch system learn!

ðŸŽ‰ **The app is live and learning!**
