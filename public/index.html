<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Yummy Food Time</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            overflow-x: hidden;
            width: 100%;
            max-width: 100vw;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', sans-serif;
            background: #F5F1E8;
            min-height: 100vh;
            padding-bottom: 40px;
            position: relative;
        }
        
        /* Subtle texture */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(74, 74, 31, 0.02) 2px,
                    rgba(74, 74, 31, 0.02) 4px
                );
            pointer-events: none;
            z-index: 0;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 12px;
            width: 100%;
            overflow-x: hidden;
            box-sizing: border-box;
            position: relative;
            z-index: 1;
        }
        
        /* HEADER */
        .header {
            background: linear-gradient(135deg, #FFC107 0%, #FFD54F 100%);
            padding: 28px 24px;
            margin-bottom: 20px;
            box-shadow: 
                8px 8px 0 rgba(74, 74, 31, 0.3),
                0 8px 24px rgba(0, 0, 0, 0.15);
            border: 4px solid #4A4A1F;
            position: relative;
            overflow: hidden;
        }
        
        .header::before,
        .header::after {
            content: '';
            position: absolute;
            width: 60px;
            height: 60px;
            background: #FF9800;
            border: 3px solid #4A4A1F;
        }
        
        .header::before {
            top: -30px;
            left: -30px;
            transform: rotate(45deg);
        }
        
        .header::after {
            bottom: -30px;
            right: -30px;
            transform: rotate(45deg);
            background: #6B6B3D;
        }
        
        @media (max-width: 768px) {
            .header {
                padding: 24px 20px;
            }
            
            .header::before,
            .header::after {
                width: 40px;
                height: 40px;
            }
            
            .header::before {
                top: -20px;
                left: -20px;
            }
            
            .header::after {
                bottom: -20px;
                right: -20px;
            }
        }
        
        h1 {
            color: #4A4A1F;
            font-size: 42px;
            font-weight: 900;
            margin-bottom: 8px;
            text-shadow: 
                3px 3px 0 rgba(255, 255, 255, 0.4),
                -1px -1px 0 rgba(0, 0, 0, 0.1);
            position: relative;
            letter-spacing: -1px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 2;
        }
        
        h1:hover {
            transform: scale(1.02);
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 32px;
            }
            
            /* Logo responsive sizing */
            .header > div[onclick="goHome()"] > div {
                font-size: 28px !important;
                letter-spacing: 1px !important;
            }
        }
        
        .subtitle {
            color: #4A4A1F;
            font-size: 16px;
            font-weight: 700;
            position: relative;
            text-transform: uppercase;
            letter-spacing: 1px;
            z-index: 2;
        }
        
        @media (max-width: 768px) {
            .subtitle {
                font-size: 14px;
            }
        }
        
        /* TOP BUTTONS */
        .top-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            position: relative;
            z-index: 2;
        }
        
        .top-btn {
            flex: 1;
            padding: 12px 16px;
            background: #F5F1E8;
            border: 3px solid #4A4A1F;
            border-radius: 24px;
            font-size: 14px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #4A4A1F;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 4px 4px 0 rgba(74, 74, 31, 0.25);
        }
        
        .top-btn:hover {
            background: #FF9800;
            transform: translateY(-2px);
            box-shadow: 5px 5px 0 rgba(74, 74, 31, 0.3);
        }
        
        @media (max-width: 768px) {
            .top-btn {
                padding: 10px 12px;
                font-size: 12px;
            }
        }
        
        /* VIEWS */
        .view {
            display: none;
        }
        
        .view.active {
            display: block;
            animation: fadeInSlide 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes fadeInSlide {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* CHOICE CARDS (Take Out / Cook at Home) */
        .choice-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 40px;
        }
        
        @media (max-width: 768px) {
            .choice-cards {
                grid-template-columns: 1fr;
                gap: 16px;
            }
        }
        
        .choice-card {
            background: white;
            border: 4px solid #4A4A1F;
            padding: 60px 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 6px 6px 0 rgba(74, 74, 31, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .choice-card::before {
            content: '';
            position: absolute;
            top: -100%;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #FFC107 0%, #FF9800 100%);
            transition: top 0.3s ease;
            z-index: 0;
        }
        
        .choice-card:hover::before {
            top: 0;
        }
        
        .choice-card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 10px 10px 0 rgba(74, 74, 31, 0.3);
        }
        
        .choice-icon {
            font-size: 80px;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
            transition: all 0.3s ease;
        }
        
        .choice-card:hover .choice-icon {
            transform: scale(1.2) rotate(10deg);
        }
        
        .choice-title {
            font-size: 28px;
            font-weight: 900;
            color: #4A4A1F;
            text-transform: uppercase;
            letter-spacing: -0.5px;
            position: relative;
            z-index: 1;
            transition: all 0.3s ease;
        }
        
        .choice-card:hover .choice-title {
            color: white;
            text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.2);
        }
        
        @media (max-width: 768px) {
            .choice-card {
                padding: 50px 20px;
            }
            
            .choice-icon {
                font-size: 64px;
            }
            
            .choice-title {
                font-size: 24px;
            }
        }
        
        /* FILTER TILES */
        .filter-section {
            margin-top: 30px;
        }
        
        .filter-section h2 {
            color: #4A4A1F;
            font-size: 28px;
            font-weight: 900;
            text-transform: uppercase;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        @media (max-width: 768px) {
            .filter-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
        }
        
        .filter-tile {
            background: white;
            border: 4px solid #B4B85E;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 4px 4px 0 rgba(180, 184, 94, 0.2);
        }
        
        .filter-tile:hover {
            border-color: #FF9800;
            transform: translateY(-3px);
            box-shadow: 5px 5px 0 rgba(255, 152, 0, 0.3);
        }
        
        .filter-tile.selected {
            background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
            border-color: #4A4A1F;
            color: white;
            transform: scale(1.05);
        }
        
        .filter-tile.random {
            background: linear-gradient(135deg, #6B6B3D 0%, #5A5A32 100%);
            border-color: #4A4A1F;
            color: #FFC107;
        }
        
        .filter-tile.random:hover {
            transform: scale(1.08) rotate(5deg);
        }
        
        .filter-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }
        
        .filter-name {
            font-size: 16px;
            font-weight: 800;
            text-transform: uppercase;
        }
        
        .filter-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        
        .filter-btn {
            padding: 16px 40px;
            background: linear-gradient(135deg, #6B6B3D 0%, #5A5A32 100%);
            color: #FFC107;
            border: 4px solid #4A4A1F;
            font-size: 18px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 5px 5px 0 rgba(74, 74, 31, 0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .filter-btn:hover {
            transform: translateY(-3px);
            box-shadow: 6px 6px 0 rgba(74, 74, 31, 0.3);
        }
        
        @media (max-width: 768px) {
            .filter-btn {
                padding: 14px 30px;
                font-size: 16px;
            }
        }
        
        /* RECOMMENDATION SCREEN */
        .recommendation {
            background: white;
            border: 4px solid #4A4A1F;
            padding: 40px 30px;
            box-shadow: 6px 6px 0 rgba(74, 74, 31, 0.2);
            margin-top: 30px;
        }
        
        .rec-title {
            font-size: 32px;
            font-weight: 900;
            color: #FF9800;
            text-transform: uppercase;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .rec-info-header {
            background: linear-gradient(135deg, #FEFDF8 0%, #FFF9E6 100%);
            border: 3px solid #B4B85E;
            padding: 20px;
            margin-bottom: 24px;
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .rec-info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            font-weight: 700;
            color: #4A4A1F;
        }
        
        .rec-info-item span {
            font-size: 20px;
        }
        
        /* Recipe Toggle Buttons (separate from content box) */
        .recipe-toggles {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            justify-content: center;
        }
        
        .recipe-toggle {
            flex: 1;
            max-width: 200px;
            padding: 14px 20px;
            background: linear-gradient(135deg, #F5F1E8 0%, #E8E4D8 100%);
            border: 4px solid #4A4A1F;
            font-size: 15px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #4A4A1F;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-align: center;
            box-shadow: 3px 3px 0 rgba(74, 74, 31, 0.2);
            border-radius: 8px;
        }
        
        .recipe-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 4px 4px 0 rgba(74, 74, 31, 0.3);
        }
        
        .recipe-toggle.active {
            background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
            color: white;
            box-shadow: 4px 4px 0 rgba(255, 152, 0, 0.3);
        }
        
        /* Recipe Content Box (simple bordered box) */
        .recipe-content-box {
            background: white;
            border: 4px solid #4A4A1F;
            padding: 24px;
            box-shadow: 6px 6px 0 rgba(74, 74, 31, 0.2);
            margin-bottom: 20px;
        }
        
        .recipe-section {
            display: none;
        }
        
        .recipe-section.active {
            display: block;
        }
        
        .recipe-section h4 {
            font-size: 18px;
            font-weight: 800;
            color: #4A4A1F;
            margin-bottom: 12px;
            text-transform: uppercase;
        }
        
        .recipe-section ul {
            margin-left: 20px;
            margin-bottom: 16px;
        }
        
        .recipe-section li {
            margin-bottom: 8px;
        }
        
        .recipe-section p {
            margin-bottom: 12px;
            white-space: pre-wrap;
        }
        
        .rec-content {
            font-size: 18px;
            line-height: 1.8;
            color: #333;
            margin-bottom: 30px;
        }
        
        .rec-details {
            background: linear-gradient(135deg, #FEFDF8 0%, #FFF9E6 100%);
            border: 4px solid #4A4A1F;
            border-bottom: none;
            padding: 20px;
            margin-bottom: 0;
        }
        
        .back-btn {
            background: linear-gradient(135deg, #78909C 0%, #607D8B 100%);
            color: white;
            padding: 14px 30px;
            border: 4px solid #4A4A1F;
            font-size: 16px;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 4px 4px 0 rgba(69, 90, 100, 0.3);
            text-transform: uppercase;
            margin-bottom: 20px;
            display: inline-block;
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 5px 5px 0 rgba(69, 90, 100, 0.3);
        }
        
        /* FLOATING CHAT BUTTON */
        .chat-float-btn {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
            border: 4px solid #4A4A1F;
            border-radius: 50%;
            font-size: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.3),
                4px 4px 0 rgba(74, 74, 31, 0.3);
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        .chat-float-btn:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 
                0 6px 16px rgba(0, 0, 0, 0.4),
                6px 6px 0 rgba(74, 74, 31, 0.4);
        }
        
        @media (max-width: 768px) {
            .chat-float-btn {
                width: 56px;
                height: 56px;
                font-size: 28px;
                bottom: 20px;
                right: 20px;
            }
        }
        
        /* CHAT OVERLAY */
        .chat-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .chat-overlay.active {
            display: flex;
        }
        
        .chat-box {
            background: white;
            border: 4px solid #4A4A1F;
            box-shadow: 8px 8px 0 rgba(74, 74, 31, 0.3);
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            background: linear-gradient(135deg, #FFC107 0%, #FFD54F 100%);
            border-bottom: 4px solid #4A4A1F;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chat-header h3 {
            font-size: 24px;
            font-weight: 900;
            color: #4A4A1F;
            text-transform: uppercase;
        }
        
        .chat-close {
            background: #EF5350;
            border: 3px solid #4A4A1F;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            font-weight: 900;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: linear-gradient(135deg, #FEFDF8 0%, #FFF9E6 100%);
            min-height: 200px;
            max-height: 400px;
        }
        
        .chat-message {
            margin-bottom: 16px;
            padding: 14px 18px;
            border: 3px solid;
            box-shadow: 3px 3px 0 rgba(0, 0, 0, 0.1);
            font-weight: 600;
            max-width: 80%;
        }
        
        .chat-message.user {
            background: linear-gradient(135deg, #4FC3F7 0%, #29B6F6 100%);
            color: white;
            border-color: #0288D1;
            margin-left: auto;
        }
        
        .chat-message.assistant {
            background: white;
            color: #333;
            border-color: #4A4A1F;
            margin-right: auto;
        }
        
        .chat-input-area {
            border-top: 4px solid #4A4A1F;
            padding: 16px;
            background: white;
            display: flex;
            gap: 12px;
        }
        
        #chatInput {
            flex: 1;
            padding: 12px;
            border: 3px solid #B4B85E;
            font-size: 15px;
            font-family: inherit;
            font-weight: 600;
        }
        
        #chatInput:focus {
            outline: none;
            border-color: #FF9800;
        }
        
        #sendChatBtn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #6B6B3D 0%, #5A5A32 100%);
            color: #FFC107;
            border: 3px solid #4A4A1F;
            font-size: 15px;
            font-weight: 800;
            cursor: pointer;
            text-transform: uppercase;
        }
        
        #sendChatBtn:hover {
            background: linear-gradient(135deg, #5A5A32 0%, #4A4A28 100%);
        }
        
        .spinner {
            border: 4px solid rgba(74, 74, 31, 0.2);
            border-top: 4px solid #FF9800;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* CARD */
        .card {
            background: white;
            padding: 28px;
            margin-bottom: 20px;
            box-shadow: 6px 6px 0 rgba(74, 74, 31, 0.2);
            border: 4px solid #4A4A1F;
        }
        
        /* Utility */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div onclick="goHome()" style="cursor: pointer; text-align: center; margin-bottom: 16px;">
                <div style="font-size: 36px; font-weight: 900; color: #4A4A1F; text-transform: uppercase; letter-spacing: 2px; text-shadow: 3px 3px 0 rgba(255, 255, 255, 0.4), -1px -1px 0 rgba(0, 0, 0, 0.1); line-height: 1; margin-bottom: 4px;">
                    YUMMY FOOD TIME
                </div>
                <p class="subtitle" style="margin: 0;">Your food decision helper</p>
            </div>
            
            <div class="top-buttons">
                <button class="top-btn" onclick="showUpload()">üì∏ Upload</button>
                <button class="top-btn" onclick="showRecipeList()">üìñ Recipes</button>
                <button class="top-btn" onclick="showHistory()">üìã History</button>
            </div>
        </div>
        
        <!-- HOME VIEW -->
        <div id="homeView" class="view active">
            <div class="choice-cards">
                <div class="choice-card" onclick="selectChoice('takeout')">
                    <div class="choice-icon">üçî</div>
                    <div class="choice-title">Take Out</div>
                </div>
                <div class="choice-card" onclick="selectChoice('cooking')">
                    <div class="choice-icon">üë©üèª‚Äçüç≥</div>
                    <div class="choice-title">Cook at Home</div>
                </div>
            </div>
        </div>
        
        <!-- FILTER VIEW -->
        <div id="filterView" class="view">
            <button class="back-btn" onclick="goHome()">‚Üê Back</button>
            
            <div class="filter-section">
                <h2 id="filterTitle">What are you looking for?</h2>
                <div class="filter-grid" id="filterGrid"></div>
                <div class="filter-actions">
                    <button class="filter-btn" onclick="getRecommendation()">Get Recommendation ‚Üí</button>
                </div>
            </div>
        </div>
        
        <!-- RECOMMENDATION VIEW -->
        <div id="recommendationView" class="view">
            <button class="back-btn" onclick="backToFilters()">‚Üê Back</button>
            
            <div class="recommendation">
                <div class="rec-title" id="recTitle"></div>
                <div class="rec-content" id="recContent"></div>
                <div class="filter-actions">
                    <button class="filter-btn" onclick="getRecommendation()">üé≤ Try Again</button>
                </div>
            </div>
        </div>
        
        <!-- UPLOAD VIEW (placeholder for now) -->
        <div id="uploadView" class="view">
            <div class="card">
                <h2 style="margin-bottom: 20px;">Upload Receipt</h2>
                <p>Upload functionality coming soon...</p>
            </div>
        </div>
        
        <!-- HISTORY VIEW (placeholder for now) -->
        <div id="historyView" class="view">
            <div class="card">
                <h2 style="margin-bottom: 20px;">Order History</h2>
                <p>History functionality coming soon...</p>
            </div>
        </div>
        
        <!-- RECIPE LIST VIEW -->
        <div id="recipeListView" class="view">
            <button class="back-btn" onclick="goHome()">‚Üê Back</button>
            
            <div class="card">
                <h2 style="margin-bottom: 20px; text-align: center; color: #FF9800;">üìñ Recipe Library</h2>
                
                <!-- Search Bar -->
                <div style="margin-bottom: 24px;">
                    <input 
                        type="text" 
                        id="recipeSearch" 
                        placeholder="üîç Search recipes..." 
                        style="width: 100%; padding: 16px; font-size: 16px; border: 4px solid #4A4A1F; border-radius: 12px; font-weight: 600; background: white;"
                        oninput="filterRecipes()"
                    />
                </div>
                
                <!-- Recipe Count -->
                <div id="recipeCount" style="margin-bottom: 16px; font-weight: 600; color: #6B6B3D; text-align: center;"></div>
            </div>
            
            <!-- Recipe List (cards outside main card for spacing) -->
            <div id="recipeListContainer"></div>
        </div>
    </div>
    
    <!-- FLOATING CHAT BUTTON -->
    <div class="chat-float-btn" onclick="toggleChat()">üí¨</div>
    
    <!-- CHAT OVERLAY -->
    <div class="chat-overlay" id="chatOverlay" onclick="closeChat(event)">
        <div class="chat-box" onclick="event.stopPropagation()">
            <div class="chat-header">
                <h3>ü§ñ Chat</h3>
                <div class="chat-close" onclick="closeChat()">√ó</div>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="chat-message assistant">
                    What can I help you find?
                </div>
            </div>
            <div class="chat-input-area">
                <input type="text" id="chatInput" placeholder="Ask me anything..." />
                <button id="sendChatBtn" onclick="sendChatMessage()">Send</button>
            </div>
        </div>
    </div>

    <script>
        let currentChoice = null;
        let selectedFilters = new Set();
        let chatHistory = [];
        
        const takeoutFilters = [
            { id: 'cheap', icon: 'üí∞', name: 'Cheap' },
            { id: 'healthy', icon: 'ü•ó', name: 'Healthy' },
            { id: 'filling', icon: 'üçó', name: 'Filling' },
            { id: 'fast', icon: '‚ö°', name: 'Fast' },
            { id: 'comfort', icon: 'üçï', name: 'Comfort' }
        ];
        
        const cookingFilters = [
            // Style filters
            { id: 'healthy', icon: 'ü•ó', name: 'Healthy' },
            { id: 'quick', icon: '‚ö°', name: 'Quick' },
            { id: 'filling', icon: 'üçó', name: 'Filling' },
            { id: 'complex', icon: 'üéì', name: 'Complex' },
            { id: 'comfort', icon: 'üßÄ', name: 'Comfort' },
            // Category filters
            { id: 'main', icon: 'üçΩÔ∏è', name: 'Main Dish' },
            { id: 'salad', icon: 'ü•ó', name: 'Salad' },
            { id: 'soup', icon: 'üçú', name: 'Soup' },
            { id: 'breakfast', icon: 'üç≥', name: 'Breakfast' },
            { id: 'dessert', icon: 'üç∞', name: 'Dessert' },
            { id: 'side', icon: 'ü•î', name: 'Side Dish' },
            { id: 'sauce', icon: 'ü•´', name: 'Sauce' },
            { id: 'appetizer', icon: 'üç§', name: 'Appetizer' }
        ];
        
        function showView(viewId) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
        }
        
        function goHome() {
            currentChoice = null;
            selectedFilters.clear();
            showView('homeView');
        }
        
        function selectChoice(choice) {
            currentChoice = choice;
            selectedFilters.clear();
            
            const filters = choice === 'takeout' ? takeoutFilters : cookingFilters;
            const filterGrid = document.getElementById('filterGrid');
            
            filterGrid.innerHTML = filters.map(f => `
                <div class="filter-tile" data-filter="${f.id}" onclick="toggleFilter('${f.id}')">
                    <div class="filter-icon">${f.icon}</div>
                    <div class="filter-name">${f.name}</div>
                </div>
            `).join('') + `
                <div class="filter-tile random" onclick="selectRandom()">
                    <div class="filter-icon">üé≤</div>
                    <div class="filter-name">Random</div>
                </div>
            `;
            
            document.getElementById('filterTitle').textContent = 
                choice === 'takeout' ? 'What type of take out?' : 'What type of meal?';
            
            showView('filterView');
        }
        
        function toggleFilter(filterId) {
            if (selectedFilters.has(filterId)) {
                selectedFilters.delete(filterId);
            } else {
                selectedFilters.add(filterId);
            }
            
            // Update UI
            document.querySelectorAll('.filter-tile[data-filter]').forEach(tile => {
                const id = tile.dataset.filter;
                if (selectedFilters.has(id)) {
                    tile.classList.add('selected');
                } else {
                    tile.classList.remove('selected');
                }
            });
        }
        
        async function selectRandom() {
            // Random with current filters applied
            await getRecommendation(true);
        }
        
        async function getRecommendation(forceRandom = false) {
            const recTitle = document.getElementById('recTitle');
            const recContent = document.getElementById('recContent');
            
            recTitle.textContent = 'Finding recommendation...';
            recContent.innerHTML = '<div class="spinner"></div>';
            showView('recommendationView');
            
            try {
                const params = new URLSearchParams({
                    type: currentChoice,
                    filters: Array.from(selectedFilters).join(','),
                    random: forceRandom
                });
                
                const response = await fetch(`/recommend?${params}`);
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || 'Failed to get recommendation');
                }
                
                recTitle.textContent = result.title || (currentChoice === 'takeout' ? 'Order This!' : 'Cook This!');
                recContent.innerHTML = result.recommendation;
                
            } catch (error) {
                console.error('Recommendation error:', error);
                recTitle.textContent = 'Oops!';
                recContent.textContent = error.message || 'Unable to get a recommendation. Please try again.';
            }
        }
        
        function backToFilters() {
            showView('filterView');
        }
        
        function switchRecipeTab(sectionName) {
            // Remove active from all toggles and sections
            document.querySelectorAll('.recipe-toggle').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.recipe-section').forEach(section => section.classList.remove('active'));
            
            // Add active to clicked toggle
            event.target.classList.add('active');
            
            // Show corresponding section
            document.getElementById(sectionName + '-section').classList.add('active');
        }
        
        function showUpload() {
            showView('uploadView');
        }
        
        function showHistory() {
            showView('historyView');
        }
        
        // RECIPE LIST FUNCTIONS
        let allRecipes = [];
        
        async function showRecipeList() {
            showView('recipeListView');
            
            // Load recipes if not already loaded
            if (allRecipes.length === 0) {
                try {
                    const response = await fetch('/api/recipes');
                    if (!response.ok) {
                        throw new Error('Failed to load recipes');
                    }
                    allRecipes = await response.json();
                } catch (error) {
                    console.error('Error loading recipes:', error);
                    document.getElementById('recipeListContainer').innerHTML = '<div class="card"><p style="text-align: center; color: #999;">Unable to load recipes. Please try again.</p></div>';
                    return;
                }
            }
            
            displayRecipes(allRecipes);
        }
        
        function filterRecipes() {
            const searchTerm = document.getElementById('recipeSearch').value.toLowerCase().trim();
            
            if (!searchTerm) {
                displayRecipes(allRecipes);
                return;
            }
            
            const filtered = allRecipes.filter(recipe => {
                return recipe.name.toLowerCase().includes(searchTerm) ||
                       (recipe.category && recipe.category.some(cat => cat.toLowerCase().includes(searchTerm))) ||
                       (recipe.ingredients && recipe.ingredients.toLowerCase().includes(searchTerm));
            });
            
            displayRecipes(filtered);
        }
        
        function displayRecipes(recipes) {
            const container = document.getElementById('recipeListContainer');
            const countDiv = document.getElementById('recipeCount');
            
            countDiv.textContent = `${recipes.length} recipe${recipes.length !== 1 ? 's' : ''}`;
            
            if (recipes.length === 0) {
                container.innerHTML = '<div class="card"><p style="text-align: center; color: #999; padding: 40px 0;">No recipes found.</p></div>';
                return;
            }
            
            container.innerHTML = recipes.map(recipe => `
                <div class="card" style="cursor: pointer; transition: all 0.2s ease; position: relative;" 
                     onclick="showRecipeDetail('${recipe.name.replace(/'/g, "\\'")}')"
                     onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='8px 8px 0 rgba(74, 74, 31, 0.3)'"
                     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='6px 6px 0 rgba(74, 74, 31, 0.2)'">
                    
                    <div style="display: flex; justify-content: space-between; align-items: start; gap: 16px;">
                        <div style="flex: 1;">
                            <h3 style="font-size: 20px; font-weight: 900; color: #4A4A1F; margin-bottom: 8px; text-transform: uppercase;">
                                ${recipe.name}
                            </h3>
                            
                            ${recipe.category ? `
                                <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 8px;">
                                    ${recipe.category.map(c => `
                                        <span style="background: linear-gradient(135deg, #FFE082 0%, #FFD54F 100%); 
                                                     padding: 4px 10px; 
                                                     border-radius: 6px; 
                                                     font-size: 12px; 
                                                     font-weight: 700; 
                                                     color: #4A4A1F; 
                                                     text-transform: uppercase; 
                                                     letter-spacing: 0.5px;
                                                     border: 2px solid #4A4A1F;">
                                            ${c}
                                        </span>
                                    `).join('')}
                                </div>
                            ` : ''}
                            
                            <div style="display: flex; gap: 16px; flex-wrap: wrap; margin-top: 12px; font-size: 14px; color: #6B6B3D; font-weight: 600;">
                                ${recipe.prep_time && recipe.prep_time !== 'N/A' ? `<span>‚è±Ô∏è Prep: ${recipe.prep_time}</span>` : ''}
                                ${recipe.cook_time && recipe.cook_time !== 'N/A' ? `<span>üî• Cook: ${recipe.cook_time}</span>` : ''}
                                ${recipe.servings && recipe.servings !== 'N/A' ? `<span>üçΩÔ∏è Servings: ${recipe.servings}</span>` : ''}
                            </div>
                        </div>
                        
                        <div style="font-size: 32px; color: #FF9800; font-weight: 900;">‚Üí</div>
                    </div>
                </div>
            `).join('');
        }
        
        async function showRecipeDetail(recipeName) {
            const recipe = allRecipes.find(r => r.name === recipeName);
            if (!recipe) return;
            
            // Simulate getting recommendation by directly setting the content
            currentChoice = 'cooking';
            const recTitle = document.getElementById('recTitle');
            const recContent = document.getElementById('recContent');
            
            recTitle.textContent = recipe.name;
            
            // Build the recipe HTML similar to server response
            let html = '<div class="rec-details">';
            
            // Info row
            html += '<div style="display: flex; gap: 20px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap;">';
            html += `<div style="text-align: center;"><div style="font-size: 24px;">‚è±Ô∏è</div><div style="font-weight: 600; color: #4A4A1F;">Prep: ${recipe.prep_time || 'N/A'}</div></div>`;
            html += `<div style="text-align: center;"><div style="font-size: 24px;">üî•</div><div style="font-weight: 600; color: #4A4A1F;">Cook: ${recipe.cook_time || 'N/A'}</div></div>`;
            html += `<div style="text-align: center;"><div style="font-size: 24px;">üçΩÔ∏è</div><div style="font-weight: 600; color: #4A4A1F;">Servings: ${recipe.servings || 'N/A'}</div></div>`;
            html += '</div>';
            
            // Toggle buttons (separate from content box)
            html += '<div class="recipe-toggles">';
            html += '<button class="recipe-toggle active" onclick="switchRecipeTab(\'ingredients\')">üìù Ingredients</button>';
            html += '<button class="recipe-toggle" onclick="switchRecipeTab(\'instructions\')">üë©üèª‚Äçüç≥ Instructions</button>';
            html += '</div>';
            
            // Content box with sections
            html += '<div class="recipe-content-box">';
            
            // Ingredients section
            html += '<div id="ingredients-section" class="recipe-section active">';
            if (recipe.ingredients) {
                const ingredients = recipe.ingredients.split('\n').filter(i => i.trim());
                html += '<ul>';
                ingredients.forEach(ing => {
                    html += `<li>${ing.trim()}</li>`;
                });
                html += '</ul>';
            } else {
                html += '<p>No ingredients listed.</p>';
            }
            html += '</div>';
            
            // Instructions section
            html += '<div id="instructions-section" class="recipe-section">';
            if (recipe.directions) {
                html += `<p>${recipe.directions.replace(/\n/g, '<br><br>')}</p>`;
            } else {
                html += '<p>No instructions available.</p>';
            }
            html += '</div>';
            
            html += '</div>'; // Close recipe-content-box
            
            // Source button
            if (recipe.source_url) {
                html += `<div style="margin-top: 24px; text-align: center;"><a href="${recipe.source_url}" target="_blank" style="display: inline-block; padding: 12px 24px; background: #FF9800; color: white; text-decoration: none; font-weight: 800; border-radius: 8px; border: 4px solid #4A4A1F; transition: all 0.2s ease;">üåê View Original Recipe</a></div>`;
            }
            
            html += '</div>';
            
            recContent.innerHTML = html;
            showView('recommendationView');
        }
        
        // CHAT FUNCTIONS
        function toggleChat() {
            document.getElementById('chatOverlay').classList.add('active');
        }
        
        function closeChat(event) {
            if (!event || event.target === document.getElementById('chatOverlay')) {
                document.getElementById('chatOverlay').classList.remove('active');
            }
        }
        
        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            const messagesDiv = document.getElementById('chatMessages');
            
            // Add user message
            const userMsgDiv = document.createElement('div');
            userMsgDiv.className = 'chat-message user';
            userMsgDiv.textContent = message;
            messagesDiv.appendChild(userMsgDiv);
            
            input.value = '';
            
            // Add loading
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'chat-message assistant';
            loadingDiv.innerHTML = '<div class="spinner" style="width: 20px; height: 20px; border-width: 2px; margin: 0;"></div>';
            messagesDiv.appendChild(loadingDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message, history: chatHistory })
                });
                
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || 'Failed to get response');
                }
                
                messagesDiv.removeChild(loadingDiv);
                
                const assistantMsgDiv = document.createElement('div');
                assistantMsgDiv.className = 'chat-message assistant';
                assistantMsgDiv.innerHTML = result.response.replace(/\n\n/g, '<br><br>');
                messagesDiv.appendChild(assistantMsgDiv);
                
                chatHistory.push(
                    { role: 'user', content: message },
                    { role: 'assistant', content: result.response }
                );
                
                if (chatHistory.length > 20) {
                    chatHistory = chatHistory.slice(-20);
                }
                
            } catch (error) {
                messagesDiv.removeChild(loadingDiv);
                
                const errorDiv = document.createElement('div');
                errorDiv.className = 'chat-message assistant';
                errorDiv.style.background = '#FFEBEE';
                errorDiv.style.borderColor = '#EF5350';
                errorDiv.textContent = '‚ùå Error: ' + error.message;
                messagesDiv.appendChild(errorDiv);
            } finally {
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }
        }
        
        // Allow Enter to send
        document.getElementById('chatInput').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                sendChatMessage();
            }
        });
    </script>
</body>
</html>
